<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    <title>NYC Crash Explorer</title>

    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Comic+Neue:wght@300;400;600&family=Montserrat+Alternates:wght@700;900&display=swap" rel="stylesheet">

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">

    <!-- fullPage.js CSS -->
    <link rel="stylesheet"
          href="https://cdnjs.cloudflare.com/ajax/libs/fullPage.js/4.0.20/fullpage.min.css"/>

    <!-- App styles -->
    <link rel="stylesheet" href="css/styles.css"/>
    <link rel="stylesheet" href="css/style2.css"/>

    <style>
    /* Fullpage up/down buttons */
    .fp-nav-btn {
      position: fixed;
      /* move left from the edge so it doesn't overlap fullPage's nav dots */
      right: 78px;
      width: 44px;
      height: 44px;
      border-radius: 999px;
      background: rgba(3,7,18,0.55);
      color: #fff;
      border: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      z-index: 1200;
      box-shadow: 0 6px 18px rgba(2,6,23,0.45);
      font-size: 18px;
      line-height: 1;
      transition: transform 120ms ease, background 120ms ease;
    }
    .fp-nav-btn:active { transform: translateY(1px); }
    .fp-nav-btn:hover { background: rgba(3,7,18,0.7); }
    #fp-up-btn { top: calc(50% - 64px); }
    #fp-down-btn { top: calc(50% + 20px); }
    @media (max-width: 767px) {
      /* on small screens push less far to avoid running off-screen */
      .fp-nav-btn { right: 56px; width:40px; height:40px; }
    }
    </style>

    <!-- D3 -->
    <script src="https://cdn.jsdelivr.net/npm/d3@7"></script>
    <!-- Leaflet CSS & JS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin=""/>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
</head>

<body>

<div id="fullpage">

    <!-- Slide 1 - Hero -->
    <section class="section" id="slide-hero">
        <div class="slide-content">
            <h1>NYC Crash Explorer</h1>

            <div id="hero-intro" class="hidden-intro">
                <p>Data: NYC Open Data - Motor Vehicle Collisions</p>
                <p>Authors: Andrew Hu; Felix Wu; Benjamin He.</p>
                <p class="scroll-hint"></p>
            </div>
        </div>
    </section>

    <!-- Slide 2 - Introduction -->
    <section class="section" id="slide-intro">
        <div class="slide-content intro-content">
            <h2>Why Explore NYC Crashes?</h2>

            <p class="intro-highlight">
                Over 200,000 traffic collisions happen in NYC each year ‚Äî
                but the risk isn‚Äôt the same everywhere or all the time.
                Understanding the patterns helps prevent injuries.
            </p>

            <div class="intro-divider"></div>

            <p class="intro-subtext">Our dashboard reveals:</p>

            <ul class="intro-list">
                <li><span class="icon">üìç</span> Where crashes concentrate</li>
                <li><span class="icon">‚è±Ô∏è</span> Which times are riskiest</li>
                <li><span class="icon">üöó</span> Vehicle & driver differences</li>
                <li><span class="icon">‚ö†Ô∏è</span> Conditions linked with injuries</li>
            </ul>
        </div>
    </section>

    <!-- Slide 3 - Orbit Map -->
    <section class="section orbit-section" id="slide-orbit">
        <iframe class="orbit-full" src="orbit/orbit.html"></iframe>
    </section>

    <!-- Slide 4 - Accident Locations (Dot Map) -->
    <section class="section" id="slide-dotmap">
      <div class="container py-5">
        <div class="row align-items-start g-4 flex-lg-row-reverse">
          <div class="col-lg-5">
            <h2 class="section-title">See where risk lives</h2>
            <p class="section-copy">How this map is made: we read the crash file, keep rows with valid date, time, and location, and render each crash as a dot. Dots keep the same on‚Äëscreen size as you zoom so clusters remain visible. Use the Hour slider to filter crashes to a specific hour (e.g., 07:00‚Äì07:59).
            Injury mode: when off, all dots share one color. When on, crashes that involved injuries are colored by number/severity (deeper color = more severe or more people hurt) and sized slightly larger; non‚Äëinjury crashes are dimmed. This highlights where injuries concentrate at the selected hour.</p>
          </div>
          <div class="col-lg-7">
            <div class="chart-card p-2 p-md-3">
              <div class="d-flex justify-content-between align-items-center flex-wrap gap-2 mb-2">
                <div class="chart-title m-0">Accident Locations on Streets (Dots)</div>
                <div class="d-flex align-items-center gap-3 flex-wrap" aria-label="Map controls">
                  <div class="d-flex align-items-center gap-2" aria-label="Filter crashes by hour">
                    <label for="hour-slider" class="form-label mb-0">Hour:</label>
                    <input id="hour-slider" type="range" min="0" max="23" step="1" value="0" class="form-range" style="width:180px" aria-valuemin="0" aria-valuemax="23" aria-valuenow="0" aria-label="Hour of day slider">
                    <output id="hour-label" for="hour-slider" class="badge bg-secondary" aria-live="polite">00:00</output>
                  </div>
                  <div class="form-check form-switch m-0">
                    <input class="form-check-input" type="checkbox" role="switch" id="map-injury-mode">
                    <label class="form-check-label" for="map-injury-mode">Injury mode</label>
                  </div>
                </div>
              </div>
              <div id="leaflet-map" class="chart-wrap" style="height:60vh;" aria-label="Leaflet basemap of New York City with crash dots filtered by selected hour"></div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Slide 5 - Quick Risk Snapshot: Day of Week -->
    <section class="section" id="slide-dow">
      <div class="container py-5">
        <h2 class="section-title mb-2">Risk by day of week</h2>
        <p class="section-copy small mb-3">
          What this shows: a simple Monday‚ÜíSunday comparison. Toggle Injury mode to switch between two views:
          ‚Ä¢ Off: total crash counts by day.
          ‚Ä¢ On: the share of crashes that involved injuries by day, with a dashed line showing the dataset average.
        </p>
        <div class="chart-card p-2 p-md-3">
          <div class="d-flex justify-content-between align-items-center flex-wrap gap-2">
            <div class="chart-title">Most dangerous day of week</div>
            <div class="form-check form-switch m-0">
              <input class="form-check-input" type="checkbox" role="switch" id="dow-injury-mode">
              <label class="form-check-label" for="dow-injury-mode">Injury mode</label>
            </div>
          </div>
          <div id="viz-dow" class="chart-wrap" style="height:52vh; min-height:420px;"></div>
        </div>
      </div>
    </section>

    <!-- Slide 6 - Quick Risk Snapshot: Vehicle type -->
    <section class="section" id="slide-vehicle">
      <div class="container py-5">
        <h2 class="section-title mb-2">Risk by vehicle type</h2>
        <p class="section-copy small mb-3">What this shows: how vehicle type relates to risk. Use the Injury mode switch to view counts vs injury share.</p>
        <div class="chart-card p-2 p-md-3">
          <div class="d-flex justify-content-between align-items-center flex-wrap gap-2">
            <div class="chart-title">Most dangerous vehicle type</div>
            <div class="form-check form-switch m-0">
              <input class="form-check-input" type="checkbox" role="switch" id="vehicle-injury-mode">
              <label class="form-check-label" for="vehicle-injury-mode">Injury mode</label>
            </div>
          </div>
          <div id="viz-vehicle" class="chart-wrap" style="height:52vh; min-height:420px;"></div>
        </div>
      </div>
    </section>

    <!-- Slide 7 - Quick Risk Snapshot: Driver sex -->
    <section class="section" id="slide-gender">
      <div class="container py-5">
        <h2 class="section-title mb-2">Male vs female drivers</h2>
        <p class="section-copy small mb-3">Outcomes by recorded driver sex. Toggle Injury mode to view counts vs injury share.</p>
        <div class="chart-card p-2 p-md-3">
          <div class="d-flex justify-content-between align-items-center flex-wrap gap-2">
            <div class="chart-title">Male vs female drivers</div>
            <div class="form-check form-switch m-0">
              <input class="form-check-input" type="checkbox" role="switch" id="gender-injury-mode">
              <label class="form-check-label" for="gender-injury-mode">Injury mode</label>
            </div>
          </div>
          <div id="viz-gender" class="chart-wrap" style="height:52vh; min-height:420px;"></div>
        </div>
      </div>
    </section>

    <!-- Slide 8 - Temporal Heatmap -->
    <section class="section" id="slide-heatmap">
      <div class="container py-3">
        <div class="row align-items-start g-4">
          <div class="col-lg-5">
            <h2 class="section-title">Find calmer hours</h2>
            <p class="section-copy">Month √ó hour grid. Injury mode switches to injury share. Normalize: Global vs Per column.</p>
          </div>
          <div class="col-lg-7">
            <div class="chart-card p-2 p-md-3">
              <div class="d-flex justify-content-between align-items-center flex-wrap gap-2">
                <div class="chart-title">Temporal Heatmap (Month √ó Hour)</div>
                <div class="d-flex align-items-center gap-3 small flex-wrap" role="group" aria-label="Heatmap controls">
                  <div class="form-check form-switch m-0">
                    <input class="form-check-input" type="checkbox" role="switch" id="hm-injury-mode">
                    <label class="form-check-label" for="hm-injury-mode">Injury mode</label>
                  </div>
                  <div class="d-flex align-items-center gap-2" aria-label="Heatmap normalization mode">
                    <span>Normalize:</span>
                    <div class="form-check form-check-inline">
                      <input class="form-check-input" type="radio" name="hm-norm" id="hm-norm-global" value="global" checked>
                      <label class="form-check-label" for="hm-norm-global">Global</label>
                    </div>
                    <div class="form-check form-check-inline">
                      <input class="form-check-input" type="radio" name="hm-norm" id="hm-norm-percol" value="perColumn">
                      <label class="form-check-label" for="hm-norm-percol">Per column</label>
                    </div>
                  </div>
                </div>
              </div>
              <div id="chart" class="chart-wrap" style="height:45vh; min-height:300px;"></div>
              <div id="chart-legend" class="legend-wrap mt-2"></div>
              <div id="time-insight" class="mt-2 small" aria-live="polite"></div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Slide 9 - Factors chart -->
    <section class="section" id="slide-factors">
      <div class="container py-5">
        <div class="row align-items-start g-4">
          <div class="col-lg-5">
            <h2 class="section-title">Choose better defaults</h2>
            <p class="section-copy">Conditions that line up with injuries more often than average.</p>
          </div>
          <div class="col-lg-7">
            <div class="chart-card p-2 p-md-3 mb-3">
              <div class="d-flex justify-content-between align-items-center flex-wrap gap-2">
                <div class="chart-title">Most explanatory factors (injury likelihood)</div>
                <div class="form-check form-switch m-0">
                  <input class="form-check-input" type="checkbox" role="switch" id="factors-injury-mode">
                  <label class="form-check-label" for="factors-injury-mode">Injury mode</label>
                </div>
              </div>
              <div id="factors" class="chart-wrap" style="height:60vh;"></div>
              <div id="factors-legend" class="legend-wrap mt-2"></div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Slide 10 - Estimator and Chains -->
    <section class="section" id="slide-estimator">
      <div class="container py-3">
        <div class="row align-items-start g-4">
          <div class="col-lg-5">
            <div class="chapter-label">Personal tool</div>
            <h2 class="section-title">Estimate injury risk</h2>
            <p class="section-copy">Enter a few basics about the situation. The estimator predicts injury probability for that combination in this dataset.</p>
          </div>
          <div class="col-lg-7">
            <div class="chart-card p-3 mb-4">
              <div class="chart-title d-flex justify-content-between align-items-center">
                <span>Your scenario</span>
                <a href="estimator-help.html" class="btn btn-sm btn-outline-light" target="_blank" rel="noopener noreferrer" title="How does this work?">?</a>
              </div>
              <form id="estimator-form" class="row g-3">
                <div class="col-sm-6 col-md-4">
                  <label for="est-vehicle" class="form-label">Vehicle type</label>
                  <select id="est-vehicle" class="form-select form-select-sm"></select>
                </div>
                <div class="col-sm-6 col-md-4">
                  <label for="est-action" class="form-label">Vehicle action</label>
                  <select id="est-action" class="form-select form-select-sm"></select>
                </div>
                <div class="col-sm-6 col-md-4">
                  <label for="est-borough" class="form-label">Borough</label>
                  <select id="est-borough" class="form-select form-select-sm"></select>
                </div>
                <div class="col-sm-6 col-md-4">
                  <label for="est-hour" class="form-label">Hour</label>
                  <select id="est-hour" class="form-select form-select-sm"></select>
                </div>
                <div class="col-sm-6 col-md-4">
                  <label for="est-dow" class="form-label">Day of week</label>
                  <select id="est-dow" class="form-select form-select-sm"></select>
                </div>
              </form>
              <div class="mt-3">
                <div id="estimator-output" class="h5" aria-live="polite">Select options to see an estimate.</div>
                <div id="estimator-note" class="small mt-2" style="color: var(--muted);">Method: L2‚Äëregularized logistic regression on hashed features (vehicle type, action, borough, hour, day of week), trained on this file‚Äôs records.</div>
              </div>
            </div>
            <div class="chart-card p-2 p-md-3">
              <div class="chart-title">Decision chains (model-based)</div>
                <div id="viz-chains" class="chart-wrap" style="height:30vh; min-height:280px;"></div>

            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Slide 11 - Conclusion -->
    <section class="section" id="slide-end">
        <div class="slide-content">
            <h2>Thanks for exploring with Group TBD</h2>
            <p>Together, we can make streets safer. </p>
        </div> </section>

    <div id="tooltip" class="tooltip"></div>

</div>

<!-- JS Libraries -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/fullPage.js/4.0.20/fullpage.min.js"></script>

<script>
    new fullpage('#fullpage', {
        navigation: true,
        navigationPosition: 'right',
        scrollOverflow: false,
        scrollingSpeed: 500,
        keyboardScrolling: true,
        controlArrows: true,

        afterLoad: function(origin, destination) {
            if (destination.index === 0) {
                document.getElementById('hero-intro').classList.add('reveal');
            }
        },

        onLeave: function(origin, destination) {
            if (origin.index === 0) {
                document.getElementById('hero-intro').classList.remove('reveal');
            }
        }
    });

      // Create persistent up/down navigation buttons and wire to fullPage API
      (function(){
        function makeBtn(id, label, title) {
          const btn = document.createElement('button');
          btn.id = id;
          btn.className = 'fp-nav-btn';
          btn.setAttribute('aria-label', label);
          btn.title = title;
          btn.type = 'button';
          return btn;
        }

        const up = makeBtn('fp-up-btn', 'Previous section', 'Previous section');
        up.innerHTML = '‚ñ≤';
        const down = makeBtn('fp-down-btn', 'Next section', 'Next section');
        down.innerHTML = '‚ñº';

        document.body.appendChild(up);
        document.body.appendChild(down);

        up.addEventListener('click', () => {
          // If the mousedown/touchstart already triggered navigation,
          // skip the click to avoid double navigation.
          if (up._fp_recentPointer) { up._fp_recentPointer = false; return; }
          if (window.fullpage_api && typeof window.fullpage_api.moveSectionUp === 'function') {
            window.fullpage_api.moveSectionUp();
          }
        });

        down.addEventListener('click', () => {
          if (down._fp_recentPointer) { down._fp_recentPointer = false; return; }
          if (window.fullpage_api && typeof window.fullpage_api.moveSectionDown === 'function') {
            window.fullpage_api.moveSectionDown();
          }
        });

        // Allow long-press / hold to repeatedly navigate (optional convenience)
        function addHoldRepeat(button, fn) {
          let timer = null; let interval = null;
          const start = () => { button._fp_recentPointer = true; fn(); timer = setTimeout(() => { interval = setInterval(fn, 200); }, 350); };
          const stop = () => { clearTimeout(timer); clearInterval(interval); timer = interval = null; setTimeout(() => { button._fp_recentPointer = false; }, 60); };
          button.addEventListener('mousedown', start);
          button.addEventListener('touchstart', start, {passive:true});
          document.addEventListener('mouseup', stop);
          document.addEventListener('touchend', stop);
          document.addEventListener('touchcancel', stop);
        }

        addHoldRepeat(up, () => window.fullpage_api && window.fullpage_api.moveSectionUp());
        addHoldRepeat(down, () => window.fullpage_api && window.fullpage_api.moveSectionDown());
      })();
</script>

<script type="module" src="js/main.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>

</body>
</html>
